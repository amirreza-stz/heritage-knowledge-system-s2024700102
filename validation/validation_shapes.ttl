# SHACL Validation Shapes for Heritage Knowledge System
# These shapes validate data quality and business rules

@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix hp: <http://webprotege.stanford.edu/> .
@prefix ex: <http://example.org/heritage/s2024700102#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# ============================================
# Shape 1: People caring for sacred items must have humanApproval
# ============================================
ex:PersonCaringForSacredItemShape
    a sh:NodeShape ;
    sh:targetClass hp:RDqiGQVsD47hrqZoozr5QsY ;
    sh:property [
        sh:path hp:RC2A3h4SFUS7L6DFLFfGllV ;
        sh:qualifiedValueShape [
            sh:path [ sh:inversePath hp:RC2A3h4SFUS7L6DFLFfGllV ] ;
            sh:class hp:R7pxWOFI810disSa49P9mBh ;
        ] ;
        sh:qualifiedMinCount 1 ;
    ] ;
    sh:property [
        sh:path hp:RSI0l4uEyriNyqJaIicRNi ;
        sh:minCount 1 ;
        sh:message "People caring for sacred items must have humanApproval property" ;
    ] ;
    sh:property [
        sh:path hp:RSI0l4uEyriNyqJaIicRNi ;
        sh:hasValue "true"^^xsd:boolean ;
        sh:message "People caring for sacred items must have humanApproval = true" ;
    ] .

# ============================================
# Shape 2: All people should have an access level
# ============================================
ex:PersonAccessLevelShape
    a sh:NodeShape ;
    sh:targetClass hp:RDqiGQVsD47hrqZoozr5QsY ;
    sh:property [
        sh:path hp:RCJaWiwRu0H17JaH2SCttq4 ;
        sh:minCount 1 ;
        sh:message "All people should have an access level" ;
    ] .

# ============================================
# Shape 3: Cultural items should have required access level
# ============================================
ex:CulturalItemAccessLevelShape
    a sh:NodeShape ;
    sh:targetSubjectsOf hp:RMGAHX6nPHqguUGyQWzWc3 ;
    sh:property [
        sh:path hp:RpDGSmirVNb6iFln2laxUV ;
        sh:minCount 1 ;
        sh:message "Cultural items should specify required access level" ;
    ] .

# ============================================
# Shape 4: Rituals should have recording date
# ============================================
ex:RitualDateShape
    a sh:NodeShape ;
    sh:targetClass hp:R7mttBU5VPhW5YJQVYDffDM ;
    sh:property [
        sh:path hp:RBboBfaALQFmlbSHTvugBOZ ;
        sh:minCount 1 ;
        sh:datatype xsd:date ;
        sh:message "Rituals must have a recording date" ;
    ] .

# ============================================
# Shape 5: Access level consistency
# ============================================
# People's access level should match or exceed required access of items they care for
ex:AccessLevelConsistencyShape
    a sh:NodeShape ;
    sh:targetClass hp:RDqiGQVsD47hrqZoozr5QsY ;
    sh:sparql [
        sh:message "Person's access level should match or exceed required access of items they care for" ;
        sh:select """
            SELECT $this ?item ?personAccess ?requiredAccess
            WHERE {
                $this hp:RC2A3h4SFUS7L6DFLFfGllV ?item .
                $this hp:RCJaWiwRu0H17JaH2SCttq4 ?personAccess .
                ?item hp:RpDGSmirVNb6iFln2laxUV ?requiredAccess .
                FILTER(?personAccess != ?requiredAccess)
            }
        """ ;
    ] .

# ============================================
# Shape 6: Performers should have instruments
# ============================================
ex:PerformerInstrumentShape
    a sh:NodeShape ;
    sh:targetClass hp:R03ZYSVq13JCMj9kLheIM8 ;
    sh:property [
        sh:path hp:R8nJXbGpvqynikgtrBpaY34 ;
        sh:minCount 1 ;
        sh:message "Performers should have at least one instrument" ;
    ] .

# ============================================
# Shape 7: Sacred items should be cared for by someone
# ============================================
ex:SacredItemCareShape
    a sh:NodeShape ;
    sh:targetClass hp:R7pxWOFI810disSa49P9mBh ;
    sh:property [
        sh:path hp:R93nXbfTdGD8uNsKFdX3LXQ ;
        sh:minCount 1 ;
        sh:message "Sacred items should be cared for by at least one person" ;
    ] .

# ============================================
# Shape 8: Data type validation
# ============================================
ex:DataTypeShape
    a sh:NodeShape ;
    sh:targetClass hp:RDqiGQVsD47hrqZoozr5QsY ;
    sh:property [
        sh:path hp:RSI0l4uEyriNyqJaIicRNi ;
        sh:datatype xsd:boolean ;
        sh:message "humanApproval must be a boolean value" ;
    ] .

ex:DateTypeShape
    a sh:NodeShape ;
    sh:targetSubjectsOf hp:RBboBfaALQFmlbSHTvugBOZ ;
    sh:property [
        sh:path hp:RBboBfaALQFmlbSHTvugBOZ ;
        sh:datatype xsd:date ;
        sh:message "recordingDate must be an xsd:date value" ;
    ] .
