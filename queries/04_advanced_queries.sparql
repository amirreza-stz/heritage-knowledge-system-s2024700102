# Advanced SPARQL Queries for Heritage Knowledge System
# Complex queries for analysis and reporting

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX hp: <http://webprotege.stanford.edu/>
PREFIX ex: <http://example.org/heritage/s2024700102#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# ============================================
# Query 1: Cultural Items by Location
# ============================================
SELECT ?location 
       (COUNT(DISTINCT ?item) as ?itemCount)
       (GROUP_CONCAT(DISTINCT ?itemType; separator=", ") as ?itemTypes)
WHERE {
    ?item a ?itemType .
    ?itemType rdfs:subClassOf hp:RMGAHX6nPHqguUGyQWzWc3 .
    ?item hp:RtLU9TCB13ZncDKBBuXmXX ?location .
}
GROUP BY ?location
ORDER BY DESC(?itemCount)

# ============================================
# Query 2: People and Their Responsibilities
# ============================================
SELECT ?person 
       (GROUP_CONCAT(DISTINCT ?role; separator=", ") as ?roles)
       (COUNT(DISTINCT ?item) as ?itemsCaredFor)
       (GROUP_CONCAT(DISTINCT ?itemType; separator=", ") as ?itemTypes)
WHERE {
    ?person a hp:RDqiGQVsD47hrqZoozr5QsY .
    OPTIONAL {
        ?person hp:RBicyNm8ZNjNz9uoAdHA05E ?role .
    }
    OPTIONAL {
        ?person hp:RC2A3h4SFUS7L6DFLFfGllV ?item .
        ?item a ?itemType .
    }
}
GROUP BY ?person
ORDER BY DESC(?itemsCaredFor)

# ============================================
# Query 3: Access Control Summary
# ============================================
SELECT ?accessLevel 
       (COUNT(DISTINCT ?person) as ?peopleCount)
       (COUNT(DISTINCT ?item) as ?itemsCount)
WHERE {
    {
        ?person hp:RCJaWiwRu0H17JaH2SCttq4 ?accessLevel .
    }
    UNION
    {
        ?item hp:RpDGSmirVNb6iFln2laxUV ?accessLevel .
    }
}
GROUP BY ?accessLevel
ORDER BY ?accessLevel

# ============================================
# Query 4: Rituals Timeline
# ============================================
SELECT ?ritual ?date ?location
WHERE {
    ?ritual a hp:R7mttBU5VPhW5YJQVYDffDM .
    ?ritual hp:RBboBfaALQFmlbSHTvugBOZ ?date .
    ?ritual hp:R8No5PZTgDSjt4MNRkbAuGe ?location .
}
ORDER BY ?date

# ============================================
# Query 5: Performers and Their Performances
# ============================================
SELECT ?performer 
       (COUNT(DISTINCT ?ritual) as ?ritualCount)
       (COUNT(DISTINCT ?instrument) as ?instrumentCount)
       (GROUP_CONCAT(DISTINCT ?ritual; separator=", ") as ?rituals)
       (GROUP_CONCAT(DISTINCT ?instrument; separator=", ") as ?instruments)
WHERE {
    ?performer a hp:R03ZYSVq13JCMj9kLheIM8 .
    OPTIONAL {
        ?performer hp:Rieouw9IXeGCWXfpJiVtUr ?ritual .
    }
    OPTIONAL {
        ?performer hp:R8nJXbGpvqynikgtrBpaY34 ?instrument .
    }
}
GROUP BY ?performer
ORDER BY ?performer

# ============================================
# Query 6: Archaeological Sites and Their Items
# ============================================
SELECT ?site ?location
       (COUNT(DISTINCT ?item) as ?itemCount)
       (GROUP_CONCAT(DISTINCT ?itemType; separator=", ") as ?itemTypes)
WHERE {
    ?site a hp:RCP2ynlETzyydBsnPQK67Qc .
    OPTIONAL {
        ?site hp:RtLU9TCB13ZncDKBBuXmXX ?location .
    }
    OPTIONAL {
        ?item hp:R8No5PZTgDSjt4MNRkbAuGe ?site .
        ?item a ?itemType .
    }
}
GROUP BY ?site ?location
ORDER BY ?site

# ============================================
# Query 7: Guardian Hierarchy
# ============================================
SELECT ?guardian ?role ?accessLevel ?approval ?elder
WHERE {
    ?guardian a hp:RDqiGQVsD47hrqZoozr5QsY .
    ?guardian hp:RBicyNm8ZNjNz9uoAdHA05E ?role .
    ?role a hp:R8n0Clv4ntakelp3R7JuFo4 .
    OPTIONAL {
        ?guardian hp:RCJaWiwRu0H17JaH2SCttq4 ?accessLevel .
    }
    OPTIONAL {
        ?guardian hp:RSI0l4uEyriNyqJaIicRNi ?approval .
    }
    OPTIONAL {
        ?guardian hp:R8fRXG3bd0ky2unGk6dEDpN ?elder .
    }
}
ORDER BY ?guardian

# ============================================
# Query 8: Cultural Items Network
# ============================================
# Shows relationships between cultural items
SELECT ?item1 ?item2 ?relationship
WHERE {
    ?item1 a ?type1 .
    ?type1 rdfs:subClassOf hp:RMGAHX6nPHqguUGyQWzWc3 .
    ?item1 ?relationship ?item2 .
    ?item2 a ?type2 .
    ?type2 rdfs:subClassOf hp:RMGAHX6nPHqguUGyQWzWc3 .
    FILTER(?item1 != ?item2)
}
ORDER BY ?item1

# ============================================
# Query 9: Statistics Summary
# ============================================
SELECT 
    (COUNT(DISTINCT ?person) as ?totalPeople)
    (COUNT(DISTINCT ?item) as ?totalItems)
    (COUNT(DISTINCT ?location) as ?totalLocations)
    (COUNT(DISTINCT ?ritual) as ?totalRituals)
    (COUNT(DISTINCT ?sacredItem) as ?totalSacredItems)
    (COUNT(DISTINCT ?artifact) as ?totalArtifacts)
    (COUNT(DISTINCT ?site) as ?totalSites)
WHERE {
    { ?person a hp:RDqiGQVsD47hrqZoozr5QsY . }
    UNION
    { ?item a ?itemType . ?itemType rdfs:subClassOf hp:RMGAHX6nPHqguUGyQWzWc3 . }
    UNION
    { ?location a hp:RBzaNvgfS1OLMV7DXLrkS4J . }
    UNION
    { ?ritual a hp:R7mttBU5VPhW5YJQVYDffDM . }
    UNION
    { ?sacredItem a hp:R7pxWOFI810disSa49P9mBh . }
    UNION
    { ?artifact a hp:RBRFcK4gcJ77AppijgltshR . }
    UNION
    { ?site a hp:RCP2ynlETzyydBsnPQK67Qc . }
}

# ============================================
# Query 10: Find All Relationships for a Specific Person
# ============================================
# Replace ex:person_guardian_01 with any person URI
SELECT ?predicate ?object
WHERE {
    ex:person_guardian_01 ?predicate ?object .
}
ORDER BY ?predicate
